enum Status {
  Started
  Ready
  Finished
}

enum ItemType {
  ERC20
  ERC1155
}

enum ItemEffect {
  Burn
  MoveToTreasury
  Custom
}

enum BuildingType {
  theforge
  ivorytower
  summoningcircle
  harvesters
  other
}

enum TreasureCategory {
  Alchemy
  Arcana
  Brewing
  Enchanting
  Leatherworking
  Smithing
}

type Config @entity {
  id: Bytes!

  cryptsRequestId: Bytes
  cryptsRound: Int!
  maxCryptsSquadsPerUser: Int!
  maxLegionsPerCryptsSquad: Int!
}

type Building @entity {
  id: Bytes!

  type: BuildingType!
  address: Bytes!
  ratePerSecond: BigInt!
  generatedCorruptionCap: BigInt!
  recipes: [Recipe!]!
}

type Recipe @entity(immutable: true) {
  id: Bytes!

  recipeId: BigInt!
  corruptionRemoved: BigInt!
  items: [RecipeItem!]! @derivedFrom(field: "recipe")
}

type RecipeItem @entity(immutable: true) {
  id: Bytes!

  recipe: Recipe!

  address: Bytes
  type: ItemType!
  effect: ItemEffect!
  effectChance: BigInt!
  itemId: BigInt
  amount: BigInt
  customHandler: Bytes
  customRequirementData: [BigInt!]
  treasureRequirement: RecipeItemTreasureRequirement @derivedFrom(field: "item")
}

type RecipeItemTreasureRequirement @entity(immutable: true) {
  id: Bytes!

  item: RecipeItem!

  tier: Int!
  category1: TreasureCategory!
  category2: TreasureCategory!
  amount: Int!
}

type Removal @entity {
  id: Bytes!

  requestId: BigInt!
  startTimestamp: BigInt!
  user: User!
  building: Building!
  recipe: Recipe!
  status: Status!
  corruptionRemoved: BigInt!
  prismMinted: BigInt
  brokenTreasureIds: [BigInt!]!
  brokenTreasureAmounts: [BigInt!]!
}

"Tracks related Randomizer commits"
type Seeded @entity {
  id: Bytes!

  "Requests related to this commit"
  requests: [Bytes!]!
}

type User @entity(immutable: true) {
  id: Bytes!

  removals: [Removal!]! @derivedFrom(field: "user")
  squads: [CryptsSquad!]! @derivedFrom(field: "user")
  rounds: [CryptsUserRound!]! @derivedFrom(field: "user")
}

type CryptsMapTile @entity(immutable: true) {
  id: Bytes!

  mapTileId: BigInt!
  moves: Int!
  north: Boolean!
  east: Boolean!
  south: Boolean!
  west: Boolean!
}

type CryptsSquad @entity {
  id: Bytes!

  squadId: BigInt!
  user: User!
  legionTokenIds: [Int!]!
  stakedTimestamp: BigInt!
  positionX: Int!
  positionY: Int!
  inTemple: Int!
}

type CryptsUserMapTile @entity {
  id: Bytes!

  userMapTileId: BigInt!
  user: User!
  mapTile: CryptsMapTile!
  positionX: Int!
  positionY: Int!
}

type CryptsUserRound @entity {
  id: Bytes!

  user: User!
  round: Int!
  mapTiles: [CryptsUserMapTile!]!
}
